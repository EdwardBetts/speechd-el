2005-04-28  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille-display-time): Value type
	changed to NUMBER.

2005-04-27  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille): New customization group.
	(speechd-braille-display-time): Changed to user options; default
	value increased to 3.
	(speechd-braille--display): New optional argument STICKY.
	(speechd-braille--create-manager): New argument DISPLAY-FUNC.
	(speechd-braille-emu-driver): Add it.

	* speechd-brltty.el (speechd-brltty-finish-message)
	(speechd-brltty-scroll-left, speechd-brltty-scroll-right)
	(speechd-brltty-current-message, speechd-brltty-next-message)
	(speechd-brltty-previous-message): New functions.
	(speechd-brltty-key-functions): Renamed to
	speechd-braille-key-functions; real functions assigned.
	(speechd-brltty-show-unknown-keys): Renamed to
	speechd-braille-show-unknown-keys.
	(speechd-brltty): Removed.
	(speechd-brltty-driver): New slot SCROLLING.
	(speechd-brltty--write): New function.
	(speechd-brltty--create-manager): Call it in the manager's writer.

2005-04-27  Milan Zamazal  <pdm@brailcom.org>

	* brltty.el (brltty-open, brltty--open-connection): New optional
	argument KEY-HANDLER.
	(brltty--connection): New slot KEY-HANDLER.
	(brltty-key-functions, brltty-show-unknown-keys): Removed.
	(brltty--read-input): Don't process a pressed key itself, call key
	handler if defined.

	* speechd-brltty.el (speechd-brltty--handle-key): New function.
	(speechd-brltty--connection): Call brltty-open with a key handler
	as an argument.
	(speechd-brltty): New customization group.
	(speechd-brltty-key-functions, speechd-brltty-show-unknown-keys):
	New user options.

	* speechd-braille.el (speechd-braille--make-message): Argument
	MESSAGE renamed to CURSOR.

2005-04-27  Milan Zamazal  <pdm@brailcom.org>

	* mmanager.el (mmanager--manager): New slots HISTORY and
	HISTORY-CURSOR.
	(mmanager-history): New function.
	(message-manager): New customization group.
	(mmanager-history-size): New user option.
	(mmanager--add-history): New function.
	(mmanager--display): Call it.

2005-04-27  Milan Zamazal  <pdm@zamazal.org>

	* speechd.el (speechd): Duplicate customization group definition
	removed.

	* brltty.el (brltty): Put the customization group into the
	speechd-el group.

2005-04-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd-brltty.el (speechd-brltty-driver): Set default value of
	brltty-connection to 'unintialized.
	(speechd-brltty--connection): Check for that value, not nil.
	(with--speechd-brltty-connection): New macro.

	* speechd-speak.el (speechd-speak--post-command-hook): Call
	speechd-in--process-command-queue.

	* brltty.el (brltty-key-functions): New user option.
	(brltty-show-unknown-keys): New user option.
	(brltty--process-filter): Renamed to brltty--process-filter*.
	(brltty--process-filter): New function.
	(brltty--process-connection): New function.
	(brltty--process-filter*): Use it.
	(brltty--read-input): New function.
	(brltty--read-answer): Rewritten.
	(brltty--answers): New variable.
	(brltty--add-answer, brltty--next-answer): New functions.
	(brltty-timeout): New user option.
	(brltty--accept-process-output): Use it.
	(brltty--send-packet): Don't call brltty--accept-process-output;
	other answer related changes.
	(brltty-display-size): brltty--send-packet arguments changed.
	(brltty--disable-connection): New function.
	(brltty--read-packet): Catch errors.
	(brltty-close, brltty-display-size, brltty-write): Do nothing if
	CONNECTION is nil.

2005-04-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd-out.el (speechd-out-keys): Missing argument added in the
	speechd.text call.

2005-04-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd-brltty.el (speechd-brltty-driver): Initial value of the
	brltty-connection slot set to nil.
	(speechd-brltty--connection): New function.
	(speechd-braille--make-message, speechd.shutdown): Use it.

2005-04-25  Milan Zamazal  <pdm@brailcom.org>

	* brltty.el (brltty-write): Let maximum cursor position be
	display-width + 1.

2005-04-25  Milan Zamazal  <pdm@brailcom.org>

	* brltty.el (brltty--send-packet): Don't try to send the packet if
	connection is closed; catch communication failures.

2005-04-25  Milan Zamazal  <pdm@brailcom.org>

	* brltty.el (brltty-tty): New user option.
	(brltty-open): Send TTY number with the getty command.

2004-12-11  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille--stop): Cancel display timer.
	(speechd-braille--display): Use speechd-braille--stop to cancel
	the display timer.

2004-12-11  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--with-updated-text): Moved
	before its first use in the source file.
	(delete-backward-char, delete-char): Updating output fixed.

2004-12-11  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille--make-message): New method.
	(speechd-braille--maybe-enqueue, speechd.text, speechd.icon)
	(speechd.char, speechd.key): Use it.

	* brltty.el (brltty--emacs-process-ok): New constant.
	(brltty--advanced-apo): Renamed to brltty--emacs-accept-ok.
	(brltty--accept-process-output): Honor the change above.
	(brltty--process-connections): New variable.
	(brltty--open-connection, brltty--process-filter, brltty-close):
	Use it.

2004-12-10  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille--create-manager): Assign the
	BRAILLE-DISPLAY property.
	(speechd-braille--display): Get the display function from it.

	* mmanager.el (mmanager--manager): New slot PROPERTIES.
	(mmanager-get, mmanager-put): New functions.

	* speechd-brltty.el: New file.

2004-12-10  Milan Zamazal  <pdm@brailcom.org>

	* brltty.el (brltty--read-answer, brltty--read-answer*)
	(brltty--read-answer): New argument ANSWER.
	(brltty-write): Honor the change above; new optional argument
	CURSOR.
	(brltty-display-size): New function.
	(brltty--read-answer*, brltty--read-answer):
	New argument PACKET-ID.
	(brltty--read-answer): Parse the answer.
	(brltty--read-integer): New function.
	(brltty--read-packet): Don't parse the answer.
	(brltty--connection): New structure.
	(brltty-open): Return connection, not a process.
	(brltty--connection-outputs): Removed.
	(brltty-coding): Turned into a user option.
	(brltty-write): Cut long texts; fill short texts with spaces.
	(brltty--open-connection): Return connection, not process.
	(brltty--process-filter): Rewritten.

2004-12-07  Milan Zamazal  <pdm@brailcom.org>

	* brltty.el: New file.

2004-12-07  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak): Belong to the speechd-el
	customization group.

	* speechd.el (speechd-el): New customization group.
	(speechd): Belong to it.

2004-12-06  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (delete-char): Use text updating.
	(speechd-speak--pre-command-hook): Don't read self-insert-command
	keys.
	(buffer-modifications): Always read self-insert-command keys here,
	with notification priority; use updated text.

2004-12-04  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--with-updated-text): New macro.
	(special-commands): Use it.
	(speechd-speak--updated-text): New function.

	* speechd-braille.el (speechd-braille--maybe-enqueue): Support for
	updating messages added.

	* mmanager.el: Completely revised, cleanup and support for
	updating messages added.

	* speechd-out.el (speechd.update): New variable.
	(speechd-out-update): New structure.
	(speechd-out-with-updated-text): New macro.

2004-11-29  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille--maybe-enqueue): New
	function.
	(speechd.text, speechd.icon, speechd.char, speechd.key): Use it.

	* mmanager.el (mmanager--enqueue*): New function.
	(mmanager-enqueue): Use it; don't enqueue blocks.
	(mmanager-start-block): Don't enqueue the message, just register
	it in blocks.
	(mmanager-finish-block): Rewritten.
	(mmanager--enqueue*): Don't enqueue void messages.
	(mmanager-cancel): Cancel block messages.

2004-11-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille--stop): New argument
	MANAGER.

	* mmanager.el (mmanager-finish-block): Use REMOVE*, not REMOVE.
	(mmanager-next): Call manager-next only if some message is
	available; if current message is open, don't finish it.
	(mmanager-start-block): Just call mmanager-enqueue.
	(mmanager--client-block): New function.
	(mmanager-enqueue): Call mmanager-next even when in block.
	(mmanager--enqueue): Don't return message*.
	(mmanager--make-message): New function.
	(mmanager-enqueue): Use it.
	(mmanager--enqueue): Take a complete message as the argument.
	(mmanager-enqueue): Honor the change above; always put
	beginning-of-block message to message blocks.

2004-11-22  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd-braille--stop)
	(speechd-braille--pause, speechd-braille--resume)
	(speechd-braille--busy): New argument MANAGER.
	(speechd-braille--resume): Call speechd-braille--display with the
	MANAGER argument.

	* mmanager.el (mmanager--busy, mmanager--stop, mmanager--pause)
	(mmanager--resume): Call the defined functions with MANAGER
	argument.

2004-11-22  Milan Zamazal  <pdm@brailcom.org>

	* speechd-braille.el (speechd.block-begin, speechd.block-end):
	Implemented.

	* mmanager.el: Unconditionally require cl.
	(mmanager--manager): New slot IN-BLOCK; slot CURRENT-MESSAGE
	removed.
	(mmanager-start-block, mmanager-finish-block): New functions.
	(mmanager--message): Slot MESSAGE renamed to MESSAGES.
	(mmanager--enqueue): Return the enqueued message instance.
	(mmanager-enqueue): Unused variable MESSAGES removed; handle block
	mode.
	(mmanager--prune-queue): Use remove-if.
	(mmanager-next): Set current message; handle block messages.

2004-11-19  Milan Zamazal  <pdm@brailcom.org>

	* mmanager.el (mmanager--display): Add MANAGER argument to the
	function call.
	(mmanager--prune-queue): Opposite use of CONDITION fixed.

	* braille.el (braille-display-mode): Disable speechd-speak-mode.
	(braille-display): Don't disable speechd-speak-mode; set
	braille-display-mode immediately after setting the buffer.

	* speechd-braille.el (speechd.char): Convert the char to string.
	(speechd.key): Convert the key to string.
	(speechd-braille--busy): Return nil if no timer is set.
	(speechd-braille-display-time): Decreased to 1.
	(speechd-braille--display): New argument MANAGER.

2004-11-19  Milan Zamazal  <pdm@brailcom.org>

	* braille.el (braille-display-mode): Set truncate-lines to t.

2004-11-12  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak-ignore-command-keys): Type
	changed from the non-existent type COMMAND to FUNCTION.

2004-11-10  Milan Zamazal  <pdm@brailcom.org>

	* speechd-compile.el (speechd-compile): Compile all *.el files.

	* speechd-braille.el: New file.

	* Makefile (compile): New source files added.

2004-11-09  Milan Zamazal  <pdm@brailcom.org>

	* mmanager.el: New file.

2004-11-05  Milan Zamazal  <pdm@brailcom.org>

	* braille.el: New file.

2004-10-27  Milan Zamazal  <pdm@brailcom.org>

	* speechd-out.el: Completely redesigned, using eieio.

	* speechd-speak.el (speechd-speak--new-connection-name): Removed.
	(speechd-speak-new-connection): Removed.
	(speechd-speak--dont-cancel-on-commands, speechd-speak-mode-map):
	speechd-* commands replaced with speechd-out-* commands.
	(speechd-unspeak): Use speechd-out-shutdown.
	(speechd-speak): Optional argument removed, use speechd-unspeak
	unconditionally; redundant code removed.

2004-10-14  Milan Zamazal  <pdm@brailcom.org>

	* Makefile: Updated for the new source set; use the
	speechd-compile.el utility.
	(.PHONY): `compile' added.

	* speechd-compile.el: New file.

	* speechd-ssip.el: New file.

	* speechd-out.el: New file.

	* speechd-speak.el (speechd-speak--text, speechd-speak--char)
	(speechd-speak--key, speechd-speak--sound): Use speechd-out-*
	functions.
	(speechd-speak--read-message): Don't mess with speechd.el
	functions, use speechd-speak--minibuffer-prompt only.
	(speechd-speak--pre-command-hook, global-speechd-speak-mode): Use
	speechd-out-* functions.
	(speechd-speak--event-mapping): Removed.
	(speechd-speak-report): Reworked; the MESSAGE argument uses no
	longer the star convention, symbols are used instead; accept nil
	as the argument; honor
	(speechd-speak-read-next-line, speechd-speak-read-previous-line)
	(special-commands): Honor the changes above.
	(speechd-speak--signal): Removed.
	(speechd-speak--minibuffer-setup-hook, special-commands)
	(speechd-speak--shutdown, speechd-speak): Honor the change above.
	(speechd-speak-read-region): Code simplified; report cursor
	position.
	(speechd-speak--key, speechd-speak--sound): Removed.
	(speechd-speak--command-keys): Rewritten.
	(special-commands): Don't use blocks, use new features instead.

