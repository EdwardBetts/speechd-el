2003-07-30  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-priority-tags): Renamed to
	speechd--priority-tags.
	(speechd-client-name): Docstring rewritten.
	(speechd--with-connection-setting): Don't enclose the VAR and
	VALUE arguments in parentheses.
	(speechd--process-request): Consider the previous change.
	
	* speechd.el All keywords converted to non-keywords.
	(speechd--keyword->nonkeyword): Removed.
	(speechd--generate-customization-options) 
	(speechd-connection-parameters): Consider the previous change.
	(speechd--generate-set-command): Consider the previous changes.

	* speechd-speak.el: All keywords converted to non-keywords.

	* speechd.el: Most `defmacro*'s changed to `defmacro'.
	* speechd-speak.el: Likewise.
	(speechd-speak--command-feedback-region): Argument MOVE removed.

2003-07-29  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak-mode-map): Typo in
	speechd-speak-read-sexp fixed.
	(speechd-speak-mode-map): Binding for speechd-repeat added.

2003-07-28  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak-mode): Don't call
	speechd-cancel.
	(global-speechd-speak-mode): New advice.
	(speechd-speak--command-info-struct): New slot CHANGE-END; assign
	default value to CHANGES.
	(speechd-speak--set-command-start-info): Don't initialize CHANGES.
	(speechd-speak--add-command-text): Argument TEXT replaced by
	arguments BEG and END; rewritten.
	(speechd-speak--after-change-hook) 
	(speechd-speak--minibuffer-update-report): Consider the previous
	change.

	* speechd.el (speechd--set-parameter): Complain on invalid
	parameter or value instead of generating an invalid SET command.

2003-07-27  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--post-command-hook): Enforce
	speechd-speak minor modes if needed.
	(speechd-speak--enforce-speak-mode): New function.
	(speechd-speak--post-command-hook): Use it.
	(speechd-speak--minibuffer-setup-hook): Call it.
	(speechd-speak-insertions-in-buffers): New user option.
	(speechd-speak--after-change-hook): Consider it; call
	speechd-speak--enforce-speak-mode.

	* speechd.el (speechd-say-text): Don't process null properties.

2003-07-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-repeat): Made interactive and marked for
	autoload.

	* speechd-speak.el (speechd-speak-quiet): Removed.
	(speechd-speak-mode): New minor mode.
	(speechd-speak--maybe-speak, speechd-speak--after-change-hook)
	(speechd-speak--pre-command-hook)
	(speechd-speak--post-command-hook): Consider the previous changes.
	(speechd-speak-keymap): Renamed to speechd-speak-mode-map.
	(speechd-speak-startup-hook): Removed.
	(speechd-speak-toggle-quiet): Removed.
	(speechd-speak, speechd-speak--shutdown): Consider the previous
	changes.
	(speechd-speak): Don't add hooks -- moved to speechd-speak-mode.
	(speechd-speak): Marked for autoload.
	(global-speechd-speak-mode): New global minor mode.
	(speechd-speak-toggle): New command.
	(speechd-speak--mode-map): New variable.
	(speechd-speak-mode): Use it.
	(speechd-speak--build-mode-map): New function; call it on
	toplevel.
	(speechd-speak-prefix): Use it; :initialize added.
	(speechd-speak--prefix): New variable.
	(speechd-speak-mode): Forward declaration added.
	(speechd-speak--interactive): New macro.
	(speechd-speak-read-char, speechd-speak-read-region)
	(speechd-speak-read-line, speechd-speak-read-next-line)
	(speechd-speak-read-previous-line, speechd-speak-read-buffer)
	(speechd-speak-read-rest-of-buffer)
	(speechd-speak-read-other-window)
	(speechd-speak--def-speak-object, speechd-speak-last-message): Use
	it.
	(speechd-speak-mode-map): Don't bind kill-emacs.
	(speechd-speak--def-speak-object): Generate docstrings too.
	(speechd-speak-last-message): Docstring added.
	(speechd-speak-toggle): Renamed to speechd-speak-toggle-speaking.
	(speechd-speak-read-region): Send empty text signalization with
	speechd-default-priority, not :message priority.
	(speechd-speak-map-mode): New minor mode.
	(speechd-speak-mode): Turn it on.
	(global-speechd-speak-map-mode): New global minor mode.
	(speechd-speak): Turn it on.
	(global-speechd-speak-mode): TURN-ON argument fixed.

2003-07-24  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-connection-parameters): Special meaning of
	:message-priority introduced (doc change).
	(speechd--connection): New slot FORCED-PRIORITY.
	(speechd-open): Assign it.
	(speechd--set-parameter): Consider it.
	(speechd-language): New function.
	(speechd-say-text): Generalized, language property support added.
	(speechd--with-connection-parameter): Renamed to
	speechd--with-connection-parameters.
	(speechd-default-language): New user option.
	(speechd-open): Set the default language.
	(speechd-block): Block support temporarily disabled.
	(speechd-debug, speechd--debug-info, speechd-submit-bug-report)
	(speechd-maintainer-address): Removed.
	(speechd--connection-filter): Debugging support removed.
	(speechd--generate-set-command): Generate docstrings; list
	argument handling fixed.

	* speechd-speak.el (speechd-speak-align-buffer-insertions): New
	user option.
	(speechd-speak--buffer-substring): New function.
	(speechd-speak--after-change-hook) 
	(speechd-speak--minibuffer-update-report): Use it.
	(speechd-speak--post-command-hook): Don't read linefeed if sound
	icon is used to signal end of line.
	(speechd-speak-read-line): Argument IN-MINIBUFFER removed.
	(speechd-speak--post-command-hook): Don't call
	speechd-speak-read-line with the removed argument.
	(speechd-speak-read-next-line, speechd-speak-read-previous-line):
	Don't read any line if there's no such one; read empty text icon
	instead.

2003-07-23  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--post-command-hook): Enclose
	forward/backward-char with a block.

	* speechd.el (speechd-block): New macro.
	(speechd-say-text): Use it.
	(speechd--connection): New slot IN-BLOCK.
	(speechd-block): Be reentrant.
	(speechd-block): New argument PARAMETERS.
	(speechd-say-text): Consider the previous change.

2003-07-22  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--minibuffer-update): Forgotten
	debugging variable removed.
	(speechd-speak--set-command-start-info): If not in minibuffer, set
	minibuffer-contents to 'unset.
	(speechd-speak--minibuffer-setup-hook): Set minibuffer-contents to
	minibuffer contents.
	(speechd-speak--minibuffer-update): Do nothing if
	minibuffer-contents is 'unset.  Don't handle M-x in a special way.
	(speechd-speak): Add minibuffer-setup-hook here.  Add
	minibuffer-exit-hook.
	(speechd-speak--minibuffer-exit-hook): New function.
	(speechd-speak--with-command-start-info): New macro.
	(speechd-speak--minibuffer-setup-hook)
	(speechd-speak--minibuffer-update)
	(speechd-speak--after-change-hook)
	(speechd-speak--post-command-hook): Use it.
	(speechd-speak--add-command-text): Insert text into changes only
	if it is not equal to the first changes string.
	(speechd-speak--post-command-hook): Concatenate buffer insertions
	before checking them against speechd-speak-buffer-insertions;
	concatenate them with spaces.

2003-07-21  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--pre-command-hook): Put
	speechd-speak--after-change-hook into after-change-functions.
	(speechd-speak--after-change-hook)
	(speechd-speak--pre-command-hook)
	(speechd-speak--post-command-hook): Don't perform most actions
	when speaking is disabled.
	(speechd-speak): Put speechd-speak--after-change-hook into
	after-change-functions.
	(speechd-speak--pre-command-hook): Don't put
	speechd-speak--after-change-hook into after-change-functions.
	(speechd-speak--minibuffer-update): Update
	speechd-speak--command-info-struct-minibuffer-contents.
	(speechd-speak--minibuffer-update): Handle M-x in a special way.

2003-07-19  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak-empty-message)
	(speechd-speak-beginning-of-line-message)
	(speechd-speak-end-of-line-message): Changed to internal
	variables, naming standard speechd icons.
	(speechd-speak-signal-empty)
	(speechd-speak-signal-beginning-of-line)
	(speechd-speak-signal-end-of-line): New user options.
	(speechd-speak--post-command-hook, speechd-speak-read-region):
	Consider the previous changes.
	(speechd-speak--command-info-struct): New attribute
	MINIBUFFER-CONTENTS.
	(speechd-speak--set-command-start-info): Initialize it.
	(speechd-speak--minibuffer-update-report): New function.
	(speechd-speak--add-command-text): New function.

2003-07-18  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak-toggle-quiet): New argument
	SILENTLY.
	(speechd-speak--shutdown): New function.
	(speechd-speak): Add it to kill-emacs-hook.
	(expand-abbrev, complete-symbol, lisp-complete-symbol)
	(dabbrev-expand, comint-dynamic-complete): Feedbacks removed.
	Comint and minibuffer history handling commands removed.
	(speechd-speak--speak-minibuffer-completion): Removed.
	(speechd-speak--minibuffer-update): New function.

2003-07-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--command-info-struct): New slot
	CHANGE.
	(speechd-speak--set-command-start-info): Initialize it.
	(speechd-speak-buffer-insertions): New user option.
	(speechd-speak--after-change-hook): New function.  Put it into
	after-change-functions.
	(speechd-speak--post-command-hook): Read buffer modifications.

	* speechd.el (speechd--send-string): Don't assign CONNECTION
	redundantly.  Call process-send-string with PROCESS, not
	CONNECTION.
	(speechd--send-string): Don't try to reopen the connection.
	(speechd--process-request): On answer timeout, call
	speechd--permanent-connection-failure instead of speechd-close.
	(speechd-open): Don't try to open the connection if it is a failed
	connection; new key argument FORCE-REOPEN.
	(speechd-reopen): Call speechd-open with FORCE-REOPEN.

2003-07-16  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--window-contents): Enforce
	redisplay.
	(speechd-speak--def-speak-object): Don't read the last object if
	after it.

	* speechd.el (speechd-connection-parameters): Typo in a tag fixed.
	(speechd-say-text): Optimized not to call speechd--send-data
	unnecessarily many times.
	(speechd--send-string): Set connection-failure-p on reopen.

2003-07-15  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-connection-parameters): Customization
	interface improved -- :type changed and :set and :get defined.
	(speechd--punctuation-modes, speechd--capital-character-modes):
	New constants.
	(speechd--keyword->nonkeyword): New function.
	(speechd--iterate-connections): New macro.
	(speechd--control-command): If not ALL, apply the command to all
	speechd connections.
	(speechd-connection-parameters): Don't call speechd-reopen.

	* speechd-speak.el (speechd-speak-connections): :minibuffer
	allowed as the value (docstring change only).
	(speechd-speak-connection-name): Consider the previous change.
	(speechd-speak--last-connections): New variable.
	(speechd-speak--connection-name): Use it.
	(speechd-speak-connections): Functional matcher support added;
	customization overall improved.
	(speechd-speak--connection-name): Function invocation support
	added.

2003-07-09  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: Generate capital character table commands.
	(speechd--parameter-names): :capital-character-table added.
	(speechd--list-parameter-names): :capital-character-tables added.
	(speechd--parameter-names)
	(speechd--parameter-value-mappings): capital-character-mode added.
	(speechd--generate-set-command): Support for direct completion
	definition added.
	(speechd-set-punctuation-mode): Removed.
	New setting commands: punctuation mode, chapital character mode.

2003-07-07  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-connection-parameters): Customization type
	fixed.
	(speechd-connection-parameters): Junk removed.

	* speechd-speak.el (speechd-speak-read-region): Call
	speechd-speak--text for ordinary text.

2003-07-04  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak-report): New function.
	(speechd-speak-empty-message)
	(speechd-speak-beginning-of-line-message)
	(speechd-speak-end-of-line-message): New user options.
	(speechd-speak-read-region): Use them.
	(speechd-speak--post-command-hook): Report beginnings and ends of
	lines.
	(speechd-speak--command-feedback): Unused local variable C removed.
	(speechd-speak--defadvice): Support user advices.
	(speechd-speak-function-feedback, speechd-speak-command-feedback):
	New macros.

	* speechd.el (speechd-default-voice): New user option.
	(speechd-open): Call speechd-set-voice.
	(speechd-default-voice): May be string only.
	(speechd-speak-connection-parameters): New user option.
	(speechd-open): Consider it.
	(speechd-speak-connection-parameters): Moved to the `speechd'
	group.
	(speechd-speak-connection-parameters): Renamed to
	speechd-connection-parameters.
	(speechd--connection-filter): Use connection corresponding to
	PROCESS.

2003-07-03  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--connection-name): New function.
	(speechd-speak--maybe-speak): Bound its return value to
	speechd-client-naem.
	(speechd-speak-connections): New user option.
	(speechd-speak--last-buffer-mode)
	(speechd-speak--last-connection-name)
	(speechd-speak--default-connection-name)
	(speechd-speak--special-area): New variables.
	(speechd-speak--current-message): Set speechd-speak--special-area.

2003-07-02  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-face-voices): New user option.
	(speechd--with-connection-parameter): New macro.
	(speechd-say-text): Map text faces to appropriate voices.

	* speechd-speak.el (speechd-speak--current-message): New optional
	argument REPEATABLE.
	(speechd-speak--post-command-hook): Consider the previous change.
	(speechd-speak--uniform-text-around-point): Limit property change
	searches.
	(speechd-speak--current-message): The argument REPEATABLE changed
	to RESET-LAST-SPOKEN.
	(speechd-speak--next-property-change)
	(speechd-speak--previous-property-change): New functions.
	(speechd-speak--post-command-hook): Use them.  Use
	get-char-property instead of get-text-property.
	(speechd-speak-force-auto-speak-buffers): New user option.
	(speechd-speak--post-command-hook): Consider it.
	(speechd-speak--next-property-change) 
	(speechd-speak--previous-property-change): Use
	*-char-property-change functions.
	(speechd-speak-connections): New variable.

2003-07-01  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--post-command-hook): Typo in the
	buffer-modified variable reference fixed.

2003-06-30  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd--close-process): Don't kill or delete if the
	buffer or process respectively is nil.

	* speechd-speak.el (speechd-speak-by-properties-always)
	(speechd-speak-by-properties-never): New user options.
	(speechd-speak-by-properties-on-movement): Meaning extended to a
	list of symbols.
	(speechd-speak--post-command-hook): Consider the new user options.
	(speechd-speak--command-info-struct): New structure.
	(speechd-speak--set-command-start-info): Use it.  Add new info.
	(speechd-speak-auto-speak-buffers): New user option.
	(speechd-speak--post-command-hook): Consider the above changes.
	(speechd-speak--post-command-hook): Disable some of the
	functionality in minibuffer.
	(speechd-speak--in-minibuffer-p): New function.
	(speechd-speak-read-region): New argument EMPTY-TEXT.
	(speechd-speak-read-line): New arguement IN-MINIBUFFER.
	(speechd-speak-faces): New user option.
	(speechd-speak--post-command-hook): Support it.
	(speechd-speak--post-command-hook): Speak nothing on buffer
	modifications.

2003-06-29  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak): speechd-speak-toggle-quiet
	argument fixed.
	(speechd-speak-toggle-quiet): Argument QUIET renamed to SPEAK.
	(speechd-speak--post-command-hook): Missing argument to the
	next-property-change call added.

2003-06-28  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (kill-ring-save): Advice removed.
	(speechd-speak--pre-command-hook): Forgotten reference to
	debugging variable removed.

2003-06-27  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--speak-minibuffer-completion)
	(speechd-speak--minibuffer-setup-hook): New functions.
	(minibuffer-setup-hook): Set it as the minibuffer-setup-hook.
	(speechd-speak--speak-completion): Call
	speechd-speak--reset-command-start-info.
	(speechd-speak-prefix): :set option added.
	(kill-region, kill-ring-save): Protect the informative messages by
	speechd-speak--maybe-speak.
	(speechd-speak-by-properties-on-movement): New user option.
	(speechd-speak-whole-line): New user option.
	(speechd-speak--post-command-hook): Speak uniform text if
	possible.  Read only rests of lines if requested.
	(speechd-speak--uniform-text-around-point): New function.
	(speechd-speak--pre-command-hook): Use save-match-data.
	(speechd-speak--set-command-start-info): Store
	buffer-modification-tick to the info.
	(speechd-speak-read-line): New optional argument REST-ONLY.
	(speechd-speak-read-region): Say "empty" if the region is empty.
	(speechd-speak--started): New variable.
	(speechd-speak): Use it.

2003-06-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--widget-choose-buffer-name): New
	constant.
	(scroll-other-window): New advice.
	(read-key-sequence): Be safe on nil PROMPT.
	(speechd-speak-quiet): Be no more buffer local automatically.
	(speechd-speak-toggle-quiet): New PREFIX meaning, rewritten.
	(speechd-speak-set-predefined-rate): Rewritten, changed to a
	standard interactive function.
	(speechd-speak-key-set-predefined-rate): New command.  Assign it
	to the `C-e digit' keys.  Don't assign `C-e 0'.
	(speechd-speak-toggle-quiet): New argument QUIET.
	(speechd-speak): Call speechd-reopen and speechd-speak-toggle-quiet.
	(speechd-speak-prefix): Turned into a user option.

2003-06-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--defadvice): New macro.
	(speechd-speak--command-feedback, y-or-n-p, read-key-sequence)
	(comint-output-filter): Use it.
	(speechd-speak--current-message): New function.
	(speechd-speak--post-command-hook): Use it.
	(message): New advice.
	(speechd-speak--last-spoken-message): New variable.
	(speechd-speak--post-command-hook): Set it.
	(speechd-speak--prompt): New function.
	(speechd-speak--speak-minibuffer-prompt): Use it.
	(speechd-speak--pre-command-hook): Speak prompt of interactive
	commands not setting minibuffer really.

2003-06-24  Milan Zamazal  <pdm@brailcom.org>

	* speechd-speak.el (speechd-speak--speak-new-message): Removed;
	don't add it to after-change-functions.
	(speechd-speak--command-start-info): Be vector.
	(speechd-speak--with-minibuffer-depth): New macro.
	(speechd-speak--set-command-start-info)
	(speechd-speak--reset-command-start-info)
	(speechd-speak--command-start-info): New functions.
	(speechd-speak--pre-command-hook)
	(speechd-speak--post-command-hook)
	(speechd-speak--command-feedback): Use them.  Don't check for
	minibuffer depth.
	(speechd-speak-toggle-quiet): Call speechd-stop if the new state
	is quiet.
	(y-or-n-p): New advice.
	(read-key-sequence): New advice.
	(speechd-speak-read-other-window): New function.  Assign it a key.
	(speechd-speak-read-buffer): New optional argument BUFFER.

2003-06-13  Milan Zamazal  <pdm@brailcom.org>
	
	* speechd-speak.el (speechd-speak--speak-new-message) 
	(speechd-speak--post-command-hook): Speak message with the
	priority :progress.
	(speechd-speak--speak-new-message): Forgotten reference to `pokus'
	removed.
	(kill-sentence): speechd-speak-read-sentence call fixed.
	(transpose-chars): Typo in following-char call fixed.
	(speechd-speak--command-start-info): Moved before the first
	reference.

2003-06-13  Milan Zamazal  <pdm@brailcom.org>

	* README: Rewritten.
	* install-debian.sh: Removed.
	* speechd-emacspeak.el: Removed.
	* emacspeak.patch: Removed.
	* dtk-interp.el: Removed.

2003-06-10  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (message): Moved after Emacspeak start.
	Don't require emacspeak-advice anymore.

2003-06-09  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (message): New redefinition.

	* dtk-interp.el (dtk-interp-say): Use priority :important
	unconditionally.
	(dtk-interp-current-priority): New function.
	(dtk-interp-queue, dtk-interp-speak): Use it.
	* speechd.el (speechd-priority-tags): Changed to new speechd
	priorities.
	(speechd-default-text-priority, speechd-default-sound-priority) 
	(speechd-default-char-priority, speechd-default-key-priority):
	Values changed to the new priority values.
	(speechd--parameter-value-mappings): Updated to the new priority
	values.

2003-06-03  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-say-char): Handle linefeed in a special way
	too.

	* dtk-tcl.el (dtk-speak): Some text processing removed.
	* install-debian.sh: Patch test updated.

	* dtk-interp.el (dtk-interp-set-rate) 
	(dtk-interp-set-punctuations): Do nothing.

2003-05-30  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-stop): Do nothing.
	(speechd-emacspeak-no-stop, speechd-send-command): Removed.
	(dtk-interp-queue, dtk-interp-speak): Call speechd-say-text with
	:priority :medium.
	(dtk-interp-say): Call speechd-say-text with :priority.

2003-05-29  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-set-punctuation-mode): Use `assoc', not
	`rassoc'.
	(speechd--process-request): Handle connection reopen in
	check-state.  Don't try to reopen if the current state is equal to
	NEW-STATE.
	(speechd-say-text, speechd-say-text): If TEXT is empty, don't send
	it.

	* speechd-emacspeak.el (emacspeak-keymap): Map `C-e p' and `C-e
	SPC' to speechd-pause and speechd-resume respectively.

2003-05-28  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (comint-output-filter): New redefinition.

	* speechd.el (speechd--protect): New variable.
	(speechd-protect): New macro.
	(speechd--send-request): If speechd--protect is non-nil, queue the
	request.
	(speechd--process-queues): New function.
	(speechd--process-request): Use it.
	(speechd--send-request, speechd--send-command)
	(speechd--send-data-begin, speechd--send-data-end): New argument
	NOW.
	(speechd--process-request): Call state changing functions with the
	argument NOW.

2003-05-28  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-say-text): Don't resume paused speaking.
	* dtk-interp.el (dtk-interp-pause, dtk-interp-resume): Do nothing.

	* dtk-tcl.el (dtk-speak): Don't perform text chunking.  Other
	minor simplifications.
	* install-debian.sh: Test for the presence of the newly patched
	Emacspeak code.

	* speechd.el (speechd-open): Set process input encoding to
	raw-text.
	(speechd--send-string): Recode STRING to speechd--coding-system
	before sending it to the process.

2003-05-27  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (tts-restart): New redefinition.

2003-05-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-say-char): If CHAR is space, transform it to
	the argument `space'.
	(speechd-open): Only try to set the connection parameters, if the
	connection was successfully opened.
	(speechd--process-request): Only try to reopen an invalid-state
	connection or to read an answer if no permanent failure is
	indicated.
	(speechd--permanent-connection-failure): New function.
	(speechd--send-string): Use it.
	(speechd--generate-set-command): Support for ARGDESC nil added.
	(speechd--set-output-module): New command.
	(speechd--parameter-names): :output-module added
	(speechd--process-request): Collect answer data.
	(speechd--list): Data is in the second, not first, result element.
	(speechd--generate-set-command): Insert result of completing-read
	into list.

2003-05-25  Hynek Hanke  <hanke@localhost.localdomain>

	* speechd.el (speechd-say-char): CHAR and KEY commands are sent
	without doublequotes.

2003-05-21  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-cancel, speechd-stop, speechd-pause) 
	(speechd-resume): New argument ALL.
	(speechd-resume): Argument SOFTP removed.
	(speechd--control-command): New function.

2003-05-20  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (speechd-emacspeak-auditory-icon-mapping)
	(speechd-emacspeak-default-auditory-icon): New variables.
	(speechd-emacspeak-auditory-icon): New function.  Assign it to
	emacspeak-auditory-icon-function.
	(emacspeak-use-auditory-icons): Set to t.

	* speechd.el (speechd--process-request): Delay answers if
	possible.
	(speechd-set-language, speechd-set-punctuation-mode) 
	(speechd-say-text, speechd-say-sound, speechd-say-char) 
	(speechd-say-key, speechd-cancel, speechd-stop, speechd-resume) 
	(speechd-pause, speechd-submit-bug-report): Docstring added.

2003-05-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd--process-request): Return the answer.

2003-05-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd--command-answer): Removed.
	(speechd--in-recursion): New variable.
	(speechd--process-request): Process the answers directly.

2003-05-16  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: Forgotten debugging code removed.
	(speechd--send-string): Try to reopen the connection on error, set
	failure-p if unsuccessful.  Don't handle queueing.
	(speechd-running-p): Docstring added.
	(speechd--close-process): New function.
	(speechd-close): Use it.  Remove the connection from the
	connection table.
	(speechd-open): Handle both open and reopen, the latter
	correctly.  New argument `quiet'.
	(speechd-reopen): Rewritten -- reopen all connections and message
	the resulting numbers of connections.
	(speechd--connection): sending-data-p renamed to
	transaction-state.  command-queue renamed to request-queue.  New
	slot new-state.
	(speechd--set-parameter): Store the new parameter value only if
	changed successfully.  Take care about unknown parameter state.
	(speechd--with-connection-setting): New macro.
	(speechd--send-data-end): Only call speechd--send-command.
	(speechd--request): New structure.
	(speechd--send-data-begin): New function.
	(speechd--send-data): Don't handle transaction state.  Call
	speechd--send-request instead of speechd--send-string.
	(speechd--send-request): New function.
	(speechd--send-command): Use it.  New argument transaction-state.
	(speechd--process-request): New function.
	(speechd--command-answer): Miscellaneous changes.
	(speechd-resume): Update `connection' after sending the command.
	(speechd-say-text): Resume if paused.

2003-05-15  Milan Zamazal  <pdm@brailcom.org>

	* emacspeak.patch: dtk-speak.el patched to avoid
	dtk-speaker-process processing.

	* install-debian.sh: Test for need of patch of dtk-tcl.el too.
	Install dtk-interp.el.
	Don't recompile Emacspeak if not patched.

	* speechd.el (queue-f): Require queue-f.
	(speechd--make-queue, speechd--queue-empty-p, speechd--enqueue)
	(speechd--dequeue): Removed.
	(speechd--queue-too-long-p, speechd--connection)
	(speechd--send-string, speechd--command-answer)
	(speechd--send-command): Use Elib queue functions.
	(speechd--connection): Create new connection if it doesn't exist.
	New argument create-if-needed.
	(speechd-close): Call speechd--connection with the argument.
	(speechd--command-answer): Be robust against nil output.
	(speechd--send-string): New argument expect-answer, use it in
	queuing.
	(speechd--send-command): Utilize previous change.
	(speechd--command-answer): Update for the change.
	(speechd--set-parameter): Use `equal', not `eq', when comparing
	parameter values.  Set the updated parameter list.
	(speechd-say-char, speechd-say-key): Wrap the command argument by
	double quotes.
	(speechd--command-answer): Call reading recursive answer reading
	too.
	(speechd--send-command): Don't set connection process output in
	reading answer.

2003-05-14  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (dtk-initialize): Do nothing.
	(speechd-open, speechd-close): Removed.
	(dtk-speak-server-initialized): Set it to t.

	* speechd.el: Prefix of all private variables and constants
	changed from `speechd-' to `speechd--'.
	(speechd--buffer, speechd--client-name): Be constant.
	(speechd--maximum-queue-length): New constant.
	(speechd-client-name): New variable.
	(speechd--connection, speechd--connection-output): Removed.
	(speechd--connections): New variable.
	(speechd--connection-output, speechd--sending-data-p)
	(speechd--paused-p, speechd--current-parameters): Removed.
	(speechd--connection): New structure.
	(speechd--connection): New function.
	(speechd--process-name): Updated.
	(speechd--connection-filter): Updated.
	(speechd--last-host, speechd--last-port): Removed.
	(speechd--connection-failure): Removed.
	(speechd-close): Updated.  New argument `name'.
	(speechd--reset-connection-parameters): Removed.
	(speechd-open): Updated.  Call process-kill-without-query.
	(speechd-running-p): Updated.
	(speechd--send-string): Updated.
	(speechd--with-current-connection): New macro.
	(speechd--make-queue, speechd--queue-empty-p, speechd--enqueue)
	(speechd--dequeue, speechd--queue-too-long-p): New functions.
	(speechd--command-answer): Rewritten.
	(speechd--send-data-end): Updated.  Less protective to
	sending-data-p.
	(speechd--send-data): Updated.
	(speechd--send-command): Updated.
	(speechd--set-parameter): Updated.
	(speechd--client-name): Renamed to speechd--application-name.
	(speechd-pause): 

2003-05-07  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el: Disable voice lock mode completely.

	* speechd.el (speechd--command-answer): Don't panic if a recursive
	accept-process-output is called -- just a temporary quick &
	incorrect hack.

2003-04-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (emacspeak-unibyte): Set it to nil.
	(dtk-speech-rate): Set to 0.
	(dtk-speech-rate-*): Set them before emacspeak-setup is loaded.
	(dtk-voice-table, dtk-family-table): Clear them.
	(dtk-default-voice-string, tts-voice-reset-code): Set them to "".

2003-04-24  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-queue-set-rate): Just call
	dtk-interp-set-rate.

2003-04-22  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-queue, dtk-interp-speak) 
	(dtk-interp-say, dtk-interp-letter) 
	(dtk-interp-toggle-capitalization, dtk-interp-set-punctuations):
	Updated for the new speechd.el.
	* speechd-emacspeak.el
	(speechd-protect-against-dtk-process-errors): Use
	speechd-running-p instead of speechd-connection.
	* speechd.el: All non-exported functions renamed to speechd--*.
	Most debugging code removed.
	(speechd-capitalizations, speechd-current-priority): Removed.
	(speechd-current-parameters): New variable.
	(speechd--reset-connection-parameters): Consider previous changes.
	(speechd--command-answer): Use string-match again.  Use prog1 for
	returning the speechd-connection-output value.  Return list of
	values, including the answer and its data.  Accept multiline
	answers correctly.
	(speechd-last-host, speechd-last-port): New variables.
	(speechd-open): Assign values to them.
	(speechd--set-parameter): New function.
	(speechd--set-connection-name): Use it.
	(speechd--convert-numeric): Return number.
	(speechd--transform-parameter-value): New function.
	(speechd-priorities, speechd-punctuations): Removed.
	(speechd-parameter-names, speechd-parameter-value-mappings): New
	constants.
	(speechd-set-priority, speechd-set-capitalization): Removed.
	(speechd-say): Renamed to speechd-say-text.
	(speechd-say-key): New function.
	(speechd-set-language): Turned into a command.
	(speechd--set-punctuation-mode-table): New constant.
	(speechd-set-punctuation-mode): New command.
	(speechd--generate-set-command): New macro.  New setting commands
	declared.
	(speechd-set-rate, speechd-set-punctuation): Removed.
	(speechd--list): New function.
	(speechd-list-parameter-names): New constant.
	(speechd-repeat): New command.
	(speechd--send-command): Arguments changed.
	(speechd-end-regexp, speechd-result-regexp)
	(speechd-success-regexp): New constants.

2003-04-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-set-connection-name): Prepend
	user-login-name to client name.

2003-04-16  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-priority-tags): New constant.
	(speechd-default-text-priority): Use it.
	(speechd-default-letter-priority): Use it.  Renamed to
	speechd-default-char-priority.
	(speechd-default-sound-priority, speechd-default-key-priority):
	New options.
	(speechd-say-char): Use the CHAR command.
	(speechd-say-sound): New functon.

2003-04-15  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (emacspeak-keymap): Assign "s" to
	speechd-stop.

	* speechd.el (speechd-cancel, speechd-stop, speechd-pause) 
	(speechd-resume): Add `self' as the command argument.

	* dtk-interp.el (dtk-interp-set-punctuations): `mode' is a string,
	not a symbol.
	(dtk-interp-stop): Call `speechd-cancel', not `speechd-stop'.

2003-04-14  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-set-punctuations): Changed to none,
	some, all.
	* speechd.el (speechd-punctuations): Changed to none, some, all.
	(speechd-cancel): New command.

2003-04-11  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: All `defsubst's changed to `defun'.  Autoload
	declarations added.
	(speechd-coding-system): Changed to `defconst'.
	(speechd-command-answer): New function.
	(speechd-send-command): Use it.  Don't read speechd answer.
	(speechd-send-data): Call `speechd-command-answer'.
	(speechd-connection-output): Initialize to nil.
	(speechd-reset-connection-parameters): Reset
	`speechd-connection-output'.
	(speechd-restart): Renamed to `speechd-reopen'.

2003-04-10  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-resume): New argument `soft'.
	(speechd-send-data): Use it.
	(speechd-paused-p): New variable.
	(speechd-reset-connection-parameters, speechd-pause): Set it.
	(speechd-send-command): Don't use regexps for detection of the end
	of speechd output.

2003-04-09  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (dtk-speech-rate-base): Set
	dtk-speech-rate-* variables.

	* dtk-interp.el (dtk-interp-set-rate): Convert `rate' to a number
	if it is a string.

2003-04-07  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-reset-connection-parameters): New function.
	(speechd-open, speechd-set-connection-name): Use it.

2003-04-05  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-send-data-end): Do it only if
	speechd-send-data-p is non-nil.  First send command, only then set
	the variable.
	(speechd-process-name, speechd-send-string, speechd-send-command):
	Be inlined.
	(speechd-current-priority): New variable.
	(speechd-set-priority): Call the command only if `priority' is
	different of speechd-current-priority.
	(speechd-open): Reset values of the state variables.

2003-04-04  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (speechd-emacspeak-queued-text): Removed.
	(dtk-interp-queue): Call `speechd-say' immediately.
	(dtk-interp-speak): Call `speechd-send-data-end'.

	* speechd.el (speechd-sending-data-p): New variable.
	(speechd-send-data-end): New function.
	(speechd-say): Call it.  New argument `finish'.  Let `priority' is
	a keyword argument.
	(speechd-send-command): Call it if sending data.
	(speechd-send-data): Send the SPEAK command only if
	speechd-sending-data-p is non-nil.  Don't send termination.  Send
	EOL only if needed.

2003-04-03  Milan Zamazal  <pdm@brailcom.org>

	* install-debian.sh: Apply emacspeak.patch if needed.

	* emacspeak.patch: New file.

	* speechd-emacspeak.el (emacspeak-speak-char) 
	(emacspeak-speak-this-char): New redefinitions.

	* speechd.el (speechd-send-command): Don't call sit-for.

2003-03-31  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-coding-system): Value set to 'utf-8-dos.
	(speechd-send-data): Rewritten to be faster.

2003-03-27  Milan Zamazal  <pdm@brailcom.org>

	* install-debian.sh: Set owner of the copied files.  chmod only
	the copied files.

	* speechd.el (speechd-eol): Value changed to "\n".
	(speechd-send-command): Don't handle \r at the end of line at all.
	sit-for call added.
	(speechd-open): Set process coding system.
	(speechd-coding-system): New option.

2003-03-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-default-letter-priority): Init value changed
	to :low.
	(speechd-el-version): New constant.
	(speechd-bug-report): New command.
	(speechd-maintainer-address): New constant.
	(speechd-send-command, speechd-send-data, speechd-open) 
	(speechd-close): Push more information onto speechd-debug-info.
	(speechd-send-command): Don't message debugging information.
	(speechd-eol): New constant.
	(speechd-send-command, speechd-send-data): Use it.
	(speechd-send-command): Handle correctly input with single `\n' as
	line ending.

	* install-debian.sh: New file.

2003-03-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: Speech Daemon protocol changes incorporated.

2003-03-24  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (speechd-open): Call
	process-kill-without-query only when `speechd-conneciton' is not
	null.  Set dtk-speak-server-initialized to t unconditionally.
	(dtk-speak): New advice.
	(speechd-protect-against-dtk-process-errors): New macro, including
	its invocations.

	* speechd.el (speechd-connection-filter): New function.
	(speechd-open): Set it as the process filter function.
	(speechd-connection-output): New variable.
	(speechd-send-string): New function.
	(speechd-send-command, speechd-send-data): Use it.
	(speechd-running-p): New function.
	(speechd-connection-failure): New variable.
	(speechd-open): Set it.  Be more careful about errors.  Return
	speechd-connection.
	(speechd-send-command): Rewritten to use the variable instead of
	process buffer and to consider `speechd-connection-failure'.

