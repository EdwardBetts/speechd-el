2003-05-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-say-char): If CHAR is space, transform it to
	the argument `space'.
	(speechd-open): Only try to set the connection parameters, if the
	connection was successfully opened.
	(speechd--process-request): Only try to reopen an invalid-state
	connection or to read an answer if no permanent failure is
	indicated.
	(speechd--permanent-connection-failure): New function.
	(speechd--send-string): Use it.
	(speechd--generate-set-command): Support for ARGDESC nil added.
	(speechd--set-output-module): New command.
	(speechd--parameter-names): :output-module added
	(speechd--process-request): Collect answer data.
	(speechd--list): Data is in the second, not first, result element.
	(speechd--generate-set-command): Insert result of completing-read
	into list.

2003-05-25  Hynek Hanke  <hanke@localhost.localdomain>

	* speechd.el (speechd-say-char): CHAR and KEY commands are sent without doublequotes.

2003-05-21  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-cancel, speechd-stop, speechd-pause) 
	(speechd-resume): New argument ALL.
	(speechd-resume): Argument SOFTP removed.
	(speechd--control-command): New function.

2003-05-20  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (speechd-emacspeak-auditory-icon-mapping)
	(speechd-emacspeak-default-auditory-icon): New variables.
	(speechd-emacspeak-auditory-icon): New function.  Assign it to
	emacspeak-auditory-icon-function.
	(emacspeak-use-auditory-icons): Set to t.

	* speechd.el (speechd--process-request): Delay answers if
	possible.
	(speechd-set-language, speechd-set-punctuation-mode) 
	(speechd-say-text, speechd-say-sound, speechd-say-char) 
	(speechd-say-key, speechd-cancel, speechd-stop, speechd-resume) 
	(speechd-pause, speechd-submit-bug-report): Docstring added.

2003-05-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd--process-request): Return the answer.

2003-05-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd--command-answer): Removed.
	(speechd--in-recursion): New variable.
	(speechd--process-request): Process the answers directly.

2003-05-16  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: Forgotten debugging code removed.
	(speechd--send-string): Try to reopen the connection on error, set
	failure-p if unsuccessful.  Don't handle queueing.
	(speechd-running-p): Docstring added.
	(speechd--close-process): New function.
	(speechd-close): Use it.  Remove the connection from the
	connection table.
	(speechd-open): Handle both open and reopen, the latter
	correctly.  New argument `quiet'.
	(speechd-reopen): Rewritten -- reopen all connections and message
	the resulting numbers of connections.
	(speechd--connection): sending-data-p renamed to
	transaction-state.  command-queue renamed to request-queue.  New
	slot new-state.
	(speechd--set-parameter): Store the new parameter value only if
	changed successfully.  Take care about unknown parameter state.
	(speechd--with-connection-setting): New macro.
	(speechd--send-data-end): Only call speechd--send-command.
	(speechd--request): New structure.
	(speechd--send-data-begin): New function.
	(speechd--send-data): Don't handle transaction state.  Call
	speechd--send-request instead of speechd--send-string.
	(speechd--send-request): New function.
	(speechd--send-command): Use it.  New argument transaction-state.
	(speechd--process-request): New function.
	(speechd--command-answer): Miscellaneous changes.
	(speechd-resume): Update `connection' after sending the command.
	(speechd-say-text): Resume if paused.

2003-05-15  Milan Zamazal  <pdm@brailcom.org>

	* emacspeak.patch: dtk-speak.el patched to avoid
	dtk-speaker-process processing.

	* install-debian.sh: Test for need of patch of dtk-tcl.el too.
	Install dtk-interp.el.
	Don't recompile Emacspeak if not patched.

	* speechd.el (queue-f): Require queue-f.
	(speechd--make-queue, speechd--queue-empty-p, speechd--enqueue)
	(speechd--dequeue): Removed.
	(speechd--queue-too-long-p, speechd--connection)
	(speechd--send-string, speechd--command-answer)
	(speechd--send-command): Use Elib queue functions.
	(speechd--connection): Create new connection if it doesn't exist.
	New argument create-if-needed.
	(speechd-close): Call speechd--connection with the argument.
	(speechd--command-answer): Be robust against nil output.
	(speechd--send-string): New argument expect-answer, use it in
	queuing.
	(speechd--send-command): Utilize previous change.
	(speechd--command-answer): Update for the change.
	(speechd--set-parameter): Use `equal', not `eq', when comparing
	parameter values.  Set the updated parameter list.
	(speechd-say-char, speechd-say-key): Wrap the command argument by
	double quotes.
	(speechd--command-answer): Call reading recursive answer reading
	too.
	(speechd--send-command): Don't set connection process output in
	reading answer.

2003-05-14  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (dtk-initialize): Do nothing.
	(speechd-open, speechd-close): Removed.
	(dtk-speak-server-initialized): Set it to t.

	* speechd.el: Prefix of all private variables and constants
	changed from `speechd-' to `speechd--'.
	(speechd--buffer, speechd--client-name): Be constant.
	(speechd--maximum-queue-length): New constant.
	(speechd-client-name): New variable.
	(speechd--connection, speechd--connection-output): Removed.
	(speechd--connections): New variable.
	(speechd--connection-output, speechd--sending-data-p)
	(speechd--paused-p, speechd--current-parameters): Removed.
	(speechd--connection): New structure.
	(speechd--connection): New function.
	(speechd--process-name): Updated.
	(speechd--connection-filter): Updated.
	(speechd--last-host, speechd--last-port): Removed.
	(speechd--connection-failure): Removed.
	(speechd-close): Updated.  New argument `name'.
	(speechd--reset-connection-parameters): Removed.
	(speechd-open): Updated.  Call process-kill-without-query.
	(speechd-running-p): Updated.
	(speechd--send-string): Updated.
	(speechd--with-current-connection): New macro.
	(speechd--make-queue, speechd--queue-empty-p, speechd--enqueue)
	(speechd--dequeue, speechd--queue-too-long-p): New functions.
	(speechd--command-answer): Rewritten.
	(speechd--send-data-end): Updated.  Less protective to
	sending-data-p.
	(speechd--send-data): Updated.
	(speechd--send-command): Updated.
	(speechd--set-parameter): Updated.
	(speechd--client-name): Renamed to speechd--application-name.
	(speechd-pause): 

2003-05-07  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el: Disable voice lock mode completely.

	* speechd.el (speechd--command-answer): Don't panic if a recursive
	accept-process-output is called -- just a temporary quick &
	incorrect hack.

2003-04-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (emacspeak-unibyte): Set it to nil.
	(dtk-speech-rate): Set to 0.
	(dtk-speech-rate-*): Set them before emacspeak-setup is loaded.
	(dtk-voice-table, dtk-family-table): Clear them.
	(dtk-default-voice-string, tts-voice-reset-code): Set them to "".

2003-04-24  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-queue-set-rate): Just call
	dtk-interp-set-rate.

2003-04-22  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-queue, dtk-interp-speak) 
	(dtk-interp-say, dtk-interp-letter) 
	(dtk-interp-toggle-capitalization, dtk-interp-set-punctuations):
	Updated for the new speechd.el.
	* speechd-emacspeak.el
	(speechd-protect-against-dtk-process-errors): Use
	speechd-running-p instead of speechd-connection.
	* speechd.el: All non-exported functions renamed to speechd--*.
	Most debugging code removed.
	(speechd-capitalizations, speechd-current-priority): Removed.
	(speechd-current-parameters): New variable.
	(speechd--reset-connection-parameters): Consider previous changes.
	(speechd--command-answer): Use string-match again.  Use prog1 for
	returning the speechd-connection-output value.  Return list of
	values, including the answer and its data.  Accept multiline
	answers correctly.
	(speechd-last-host, speechd-last-port): New variables.
	(speechd-open): Assign values to them.
	(speechd--set-parameter): New function.
	(speechd--set-connection-name): Use it.
	(speechd--convert-numeric): Return number.
	(speechd--transform-parameter-value): New function.
	(speechd-priorities, speechd-punctuations): Removed.
	(speechd-parameter-names, speechd-parameter-value-mappings): New
	constants.
	(speechd-set-priority, speechd-set-capitalization): Removed.
	(speechd-say): Renamed to speechd-say-text.
	(speechd-say-key): New function.
	(speechd-set-language): Turned into a command.
	(speechd--set-punctuation-mode-table): New constant.
	(speechd-set-punctuation-mode): New command.
	(speechd--generate-set-command): New macro.  New setting commands
	declared.
	(speechd-set-rate, speechd-set-punctuation): Removed.
	(speechd--list): New function.
	(speechd-list-parameter-names): New constant.
	(speechd-repeat): New command.
	(speechd--send-command): Arguments changed.
	(speechd-end-regexp, speechd-result-regexp)
	(speechd-success-regexp): New constants.

2003-04-17  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-set-connection-name): Prepend
	user-login-name to client name.

2003-04-16  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-priority-tags): New constant.
	(speechd-default-text-priority): Use it.
	(speechd-default-letter-priority): Use it.  Renamed to
	speechd-default-char-priority.
	(speechd-default-sound-priority, speechd-default-key-priority):
	New options.
	(speechd-say-char): Use the CHAR command.
	(speechd-say-sound): New functon.

2003-04-15  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (emacspeak-keymap): Assign "s" to
	speechd-stop.

	* speechd.el (speechd-cancel, speechd-stop, speechd-pause) 
	(speechd-resume): Add `self' as the command argument.

	* dtk-interp.el (dtk-interp-set-punctuations): `mode' is a string,
	not a symbol.
	(dtk-interp-stop): Call `speechd-cancel', not `speechd-stop'.

2003-04-14  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (dtk-interp-set-punctuations): Changed to none,
	some, all.
	* speechd.el (speechd-punctuations): Changed to none, some, all.
	(speechd-cancel): New command.

2003-04-11  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: All `defsubst's changed to `defun'.  Autoload
	declarations added.
	(speechd-coding-system): Changed to `defconst'.
	(speechd-command-answer): New function.
	(speechd-send-command): Use it.  Don't read speechd answer.
	(speechd-send-data): Call `speechd-command-answer'.
	(speechd-connection-output): Initialize to nil.
	(speechd-reset-connection-parameters): Reset
	`speechd-connection-output'.
	(speechd-restart): Renamed to `speechd-reopen'.

2003-04-10  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-resume): New argument `soft'.
	(speechd-send-data): Use it.
	(speechd-paused-p): New variable.
	(speechd-reset-connection-parameters, speechd-pause): Set it.
	(speechd-send-command): Don't use regexps for detection of the end
	of speechd output.

2003-04-09  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (dtk-speech-rate-base): Set
	dtk-speech-rate-* variables.

	* dtk-interp.el (dtk-interp-set-rate): Convert `rate' to a number
	if it is a string.

2003-04-07  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-reset-connection-parameters): New function.
	(speechd-open, speechd-set-connection-name): Use it.

2003-04-05  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-send-data-end): Do it only if
	speechd-send-data-p is non-nil.  First send command, only then set
	the variable.
	(speechd-process-name, speechd-send-string, speechd-send-command):
	Be inlined.
	(speechd-current-priority): New variable.
	(speechd-set-priority): Call the command only if `priority' is
	different of speechd-current-priority.
	(speechd-open): Reset values of the state variables.

2003-04-04  Milan Zamazal  <pdm@brailcom.org>

	* dtk-interp.el (speechd-emacspeak-queued-text): Removed.
	(dtk-interp-queue): Call `speechd-say' immediately.
	(dtk-interp-speak): Call `speechd-send-data-end'.

	* speechd.el (speechd-sending-data-p): New variable.
	(speechd-send-data-end): New function.
	(speechd-say): Call it.  New argument `finish'.  Let `priority' is
	a keyword argument.
	(speechd-send-command): Call it if sending data.
	(speechd-send-data): Send the SPEAK command only if
	speechd-sending-data-p is non-nil.  Don't send termination.  Send
	EOL only if needed.

2003-04-03  Milan Zamazal  <pdm@brailcom.org>

	* install-debian.sh: Apply emacspeak.patch if needed.

	* emacspeak.patch: New file.

	* speechd-emacspeak.el (emacspeak-speak-char) 
	(emacspeak-speak-this-char): New redefinitions.

	* speechd.el (speechd-send-command): Don't call sit-for.

2003-03-31  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-coding-system): Value set to 'utf-8-dos.
	(speechd-send-data): Rewritten to be faster.

2003-03-27  Milan Zamazal  <pdm@brailcom.org>

	* install-debian.sh: Set owner of the copied files.  chmod only
	the copied files.

	* speechd.el (speechd-eol): Value changed to "\n".
	(speechd-send-command): Don't handle \r at the end of line at all.
	sit-for call added.
	(speechd-open): Set process coding system.
	(speechd-coding-system): New option.

2003-03-26  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el (speechd-default-letter-priority): Init value changed
	to :low.
	(speechd-el-version): New constant.
	(speechd-bug-report): New command.
	(speechd-maintainer-address): New constant.
	(speechd-send-command, speechd-send-data, speechd-open) 
	(speechd-close): Push more information onto speechd-debug-info.
	(speechd-send-command): Don't message debugging information.
	(speechd-eol): New constant.
	(speechd-send-command, speechd-send-data): Use it.
	(speechd-send-command): Handle correctly input with single `\n' as
	line ending.

	* install-debian.sh: New file.

2003-03-25  Milan Zamazal  <pdm@brailcom.org>

	* speechd.el: Speech Daemon protocol changes incorporated.

2003-03-24  Milan Zamazal  <pdm@brailcom.org>

	* speechd-emacspeak.el (speechd-open): Call
	process-kill-without-query only when `speechd-conneciton' is not
	null.  Set dtk-speak-server-initialized to t unconditionally.
	(dtk-speak): New advice.
	(speechd-protect-against-dtk-process-errors): New macro, including
	its invocations.

	* speechd.el (speechd-connection-filter): New function.
	(speechd-open): Set it as the process filter function.
	(speechd-connection-output): New variable.
	(speechd-send-string): New function.
	(speechd-send-command, speechd-send-data): Use it.
	(speechd-running-p): New function.
	(speechd-connection-failure): New variable.
	(speechd-open): Set it.  Be more careful about errors.  Return
	speechd-connection.
	(speechd-send-command): Rewritten to use the variable instead of
	process buffer and to consider `speechd-connection-failure'.

